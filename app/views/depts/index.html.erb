<%- model_class = Dept -%>
<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.pluralize %></h1>
</div>

<% @dept_roots = Dept.find_by_sql("select * from depts where dept_id is null") %>
<br/>
<%= nested_depts(@dept_roots) %>
<br/>
<div class="css-treeview">
<% for dept in @dept_roots %>	
 <ul>
 <li><input type="checkbox" id="item-0" />
     <label for="item-0">
  	   <%= dept.name%>
       <%= link_to image_tag("isometric/notep_16.png", :border=>0), :action => 'edit', :id => dept %>
     </label>
 <% @dept_nodes = Dept.find_by_sql("select * from depts where dept_id = #{dept.id}") %>
	<ul>
 <% for no in @dept_nodes %>
		<li>
			<input type="checkbox" id="item-0-0" />
			 <label for="item-0-0"><%= no.name%>
				<%= link_to image_tag("isometric/notep_16.png", :border=>0), :action => 'edit', :id => no %>
			 </label>
			 <% @dept_subnodes = Dept.find_by_sql("select * from depts where dept_id = #{no.id}") %>
			<ul>
				 <% for subno in @dept_subnodes %>
				  <li>
					<input type="checkbox" id="item-0-0-0" /><label for="item-0-0-0"><%= subno.name%></label>
		            <%= link_to image_tag("isometric/notep_16.png", :border=>0), :action => 'edit', :id => subno %>
				  </li>
				 <%end%>
			</ul>	
		</li>
 <%end%>
	</ul>
 </li> 
 </ul>
<% end %>
</div>


<table class="table table-striped">
  <thead>
    <tr>
      <th><%= model_class.human_attribute_name(:id) %></th>
      <th><%= model_class.human_attribute_name(:name) %></th>
      <th><%= model_class.human_attribute_name(:acronym) %></th>
      <th><%= model_class.human_attribute_name(:cnpj) %></th>
      <th><%= model_class.human_attribute_name(:site) %></th>
      <th><%= model_class.human_attribute_name(:email) %></th>
      <th><%= model_class.human_attribute_name(:dept_type_id) %></th>
      <th><%= model_class.human_attribute_name(:dept_id) %></th>
      <th><%=t '.actions', :default => t("helpers.actions") %></th>
    </tr>
  </thead>
  <tbody>
    <% @depts.each do |dept| %>
      <tr>
        <td><%= link_to dept.id, dept_path(dept) %></td>
        <td><%= dept.name %></td>
        <td><%= dept.acronym %></td>
        <td><%= dept.cnpj %></td>
        <td><%= dept.site %></td>
        <td><%= dept.email %></td>
        <td><%= dept.dept_type_id %></td>
        <td><%= dept.dept_id %></td>
        <td>
          <%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_dept_path(dept), :class => 'btn btn-mini' %>
          <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      dept_path(dept),
                      :method => :delete,
                      :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                      :class => 'btn btn-mini btn-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to t('.new', :default => t("helpers.links.new")),
            new_dept_path,
            :class => 'btn btn-primary' %>