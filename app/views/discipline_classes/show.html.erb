<%- model_class = @discipline_class.class -%>
<div class="page-header">
  <h1><i class="icon-pencil"></i> <%=t '.title', :default => model_class.model_name.human %></h1>
</div>
<div class="row-fluid">
<div class="control-group span12">
    <div class="span4">

	<dl class="dl-horizontal">
	  <dt><strong><%= SchoolClass.human_attribute_name(:matrix_id) %>:</strong></dt>
	  <dd><%=link_to "#{@discipline_class.school_class.course_matrix.id} - #{@discipline_class.school_class.course_matrix.started_at_formatted}", course_matrix_path(@discipline_class.school_class.course_matrix) %></dd>		
	  <dt><strong><%= model_class.human_attribute_name(:school_class_id) %>:</strong></dt>
	  <dd><%= link_to "#{@discipline_class.school_class.identifier}", school_class_path(@discipline_class.school_class.identifier) %> </dd>
	  <dt><strong><%= model_class.human_attribute_name(:matrix_discipline_id) %>:</strong></dt>
	  <dd><%= @discipline_class.matrix_discipline.discipline_name if @discipline_class.matrix_discipline_id %></dd>
	  <dt><strong><%= model_class.human_attribute_name(:code) %>:</strong></dt>
	  <dd><strong><%= @discipline_class.code %></strong></dd>
	  <dt><strong><%= model_class.human_attribute_name(:vancancies) %>:</strong></dt>
	  <dd><%= @discipline_class.vancancies %></dd>
	  <dt><strong><%= model_class.human_attribute_name(:started_at) %>:</strong></dt>
	  <dd><%=l @discipline_class.started_at if @discipline_class.started_at %></dd>
	  <dt><strong><%= model_class.human_attribute_name(:ending_at) %>:</strong></dt>
	  <dd><%=l @discipline_class.ending_at if @discipline_class.ending_at %></dd>
	  <dt><strong><%= model_class.human_attribute_name(:timetable_started_at) %>:</strong></dt>
	  <dd><%=l @discipline_class.timetable_started_at if @discipline_class.timetable_started_at %></dd>
	</dl>
   </div>

	<!-- Docentes -->
	<div class="span2">
	  <div class="well">
	      <fieldset>
	          <%= link_to "<div style='font-size: 16px;  padding-top:4px; '><i class='icon-user'></i> Docentes </div>".html_safe,
	            discipline_class_class_teachings_path(@discipline_class), :class => 'btn btn-inverse span12' %>
	         <div style="padding-top: 60px">
	           <% @discipline_class.class_teachings.each do |teacher| %>
			    <dd><%= teacher.person.name %></dd>
			  <%end%>
			    <dd><center><%= '...sem docente vinculado...' if @discipline_class.class_teachings.count == 0 %></center></dd>
	         </div>
	      </fieldset>
	  </div>
	</div>

	<!-- Aulas -->
	<div class="span6">
	  <div class="well">
	      <fieldset>
	          <%= link_to "<div style='font-size: 16px;  padding-top:4px; '><i class='icon-pencil'></i> Aulas </div>".html_safe,
	            discipline_class_class_records_path(@discipline_class), :class => 'btn btn-inverse span12' %>
	         <div style="padding-top: 60px">
		       <table class="table table-striped table-condensed">
	           <% @discipline_class.class_records.each_with_index do |record, i| %>
			    <tr><td><%= I18n.localize(record.recorded_at) %> <%= record.class_time.try(:model_custom_name)%> <%= record.record%></td></tr>
			    <% break if i == 5 %>
				<%end%>
    			<tr><td><%= link_to "...mais...", discipline_class_class_records_path(@discipline_class) %></td></tr>
			  </table> 
			    <dd><center><%= '...sem aula cadastrada...' if @discipline_class.class_records.count == 0 %></center></dd>
	         </div>
	      </fieldset>
	      <fieldset>
	      <div class=" btn-group pull-left">
			  <a class="btn dropdown-toggle btn-small" data-toggle="dropdown" href="#">
			    <i class='icon-print'></i>Imprimir Conteúdo Ministrado
			    <span class="caret"></span>
			  </a>
			  <ul class="dropdown-menu">
			    <li><%= link_to "Preenchido", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "school_class", :preenchido => true ), :tabindex => "-1" %></li>
				<li><%= link_to "Em Branco", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "school_class" ), :tabindex => "-1" %></li>
			  </ul>
		  </div>
		  <div class=" btn-group pull-right">
			  <a class="btn dropdown-toggle btn-small" data-toggle="dropdown" href="#">
			    <i class='icon-print'></i>Imprimir Diário de Frequência
			    <span class="caret"></span>
			  </a>
			  <ul class="dropdown-menu">
			    <li><%= link_to "Preenchido", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "class_record", :preenchido => true ), :tabindex => "-1" %></li>
				<li><%= link_to "Em Branco", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "class_record" ), :tabindex => "-1" %></li>
			  </ul>
		  </div>
		  </fieldset>
	  </div>
	</div>	
	
	<!-- Avaliacoes -->
	<div class="span12">
	  <div class="well">
	      <fieldset>
	          <%= link_to "<div style='font-size: 16px;  padding-top:4px; '><i class='icon-pencil'></i> Avaliações </div>".html_safe,
	            discipline_class_discipline_class_exams_path(@discipline_class), :class => 'btn btn-inverse span12' %>
	         <div style="padding-top: 60px">
 		     <% if @discipline_class.discipline_class_exams.count > 0 %>
			       <table class="table table-condensed table-bordered table-hover">
					<thead>
					 <tr> 	
					   <th rowspan="2"><center>#</center></th>	
					   <th rowspan="2"><center>Aluno</center></th>	
					   <th rowspan="2"><center><%= link_to '%', "#", :rel => "tooltip", "data-placement"=>"top", "data-original-title" => "Percentual de Presenças", :disabled => true %></center></th>	
		               <% @discipline_class.discipline_class_exams.each_with_index do |exam, i| %>
					      <th rowspan="2"><center><%=link_to ( (exam.applied_at ? exam.applied_at.strftime("%d/%m/%Y") : 'sem data') + '<br/>' + exam.title).html_safe, discipline_class_discipline_class_exam_discipline_class_exam_results_path(@discipline_class, exam) %></center></th>
				       <%end%>
				       <th rowspan="2"><center><%= link_to 'C', "#", :rel => "tooltip", "data-placement"=>"top", "data-original-title" => "Nota de Conselho", :disabled => true %></center></th>
	   			       <th rowspan="2"><center>Média<br/>( ∑(n*p) / ∑(p) )</center></th>
       	               <th colspan="2">
	                     <center>Situação</center>
	                   </th>	
					 </tr>
					<tr>
					     <th><center>Prevista</center></th>
					     <th><center>Atual</center></th>
					</tr>					
				    </thead>
				    <tbody>
		               <% @discipline_class.registration_classes.sort_by(&:student_name).each_with_index do |rclass, i| %>
					      <tr class="<%= h_status_color(rclass)%>">
	    					<td><%= i+1 %></td>
						    <td> <%= link_to rclass.student_name, discipline_class_registration_class_path(@discipline_class,rclass) %></td>
						    <td><center><%= rclass.frequency %></center></td>
							<% @discipline_class.discipline_class_exams.each_with_index do |exam, i| %>
							   <%nota = DisciplineClassExamResult.where(:discipline_class_exam_id => exam.id).where(:registration_class_id => rclass.id).first.try(:result) %>
							   <td><center> <h5><%= (nota.blank? ? '0.0' : nota.to_s) %> <small>x<%=exam.weight%></small></h5> </center></td>
						    <%end%>
 						       <td><center> <h5>0.0</h5> </center></td>	
						       <td><center> <h5> <%= rclass.model_student_result_average.round(2) %> </h5></center></td>	
						       <td>
	                            <center> 
                                    <% rclass.registration_class_status_situations.each do |situation| %>            
 	                                  <div> <small> <%= situation %> </small></div>
                                    <%end%>
	                            </center>
	                          </td>
 						       <td><center> <h6> <%= rclass.registration_class_status.description %> </h6></center></td>	
						  </tr>
				       <%end%>				
				  </tbody>
			     </table> 
			<%else%>
			      <dd><center><%= '...sem avaliação cadastrada...' if @discipline_class.discipline_class_exams.count == 0 %></center></dd>
			<% end %>			    
	         </div>
	      </fieldset>
	      <fieldset>
			 <div class="btn-group pull-left">
		     	<!-- Informações de regras academicas -->
		        <ul>
			     <h5>Regras acadêmicas:</h5>
			        <ul>
				      <%if @discipline_class.school_class.course_matrix.course_matrix_academic_rules.count > 0 %>
						 <%@discipline_class.school_class.course_matrix.course_matrix_academic_rules.each do |rules|%>
					      <li><%= rules.academic_rule.academic_rule_type.rule %> <%= rules.academic_rule.operator %> <%= rules.academic_rule.value %>%</li>
					     <%end%>					     
						  <ul class="unstyled">
							 <%= form_for @discipline_class, :url => discipline_class_close_path(@discipline_class), :html => { :class => 'form-horizontal'} do |f| %>
							      <% classe_fechada = (@discipline_class.ending_at? ? "Classe fechada" : "Fechar classe") %>
						       	  <%= f.submit classe_fechada, :class => 'btn btn-primary', :class => "btn btn btn-success", :disabled => (true if @discipline_class.ending_at?) %>
						     <%end%>
						    
						  </ul>
					  <%else%>
					      <div class="alert alert-error">
						     <h5>Nenhuma regra acadêmica definida na matriz deste curso</h5>
						     <center><%=link_to "<i class='icon-th-list'></i> Incluir regras".html_safe, course_matrix_course_matrix_academic_rules_path(@discipline_class.school_class.course_matrix), :class => "btn btn-mini btn-primary" %></center>
						  </div>
					  <%end%>
				    </ul>				 
			    </ul>
				<!-- -->
			 </div>
			  <div class=" btn-group pull-right">
				  <a class="btn dropdown-toggle btn-small" data-toggle="dropdown" href="#">
				    <i class='icon-print'></i>Imprimir Mapa de Notas
				    <span class="caret"></span>
				  </a>
				  <ul class="dropdown-menu">
				    <li><%= link_to "Preenchido", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "class_exams", :preenchido => true ), :tabindex => "-1" %></li>
					<li><%= link_to "Em Branco", discipline_class_path(@discipline_class, :format =>  "pdf", :report_discipline => "class_exams" ), :tabindex => "-1" %></li>
				  </ul>
			  </div>
		  </fieldset>
	  </div>
	</div>	

  </div>
</div>

<div class="form-actions">
  <%= link_to "<i class='icon-undo'></i> ".html_safe + t('.back', :default => t("helpers.links.back")),
              discipline_classes_path, :class => 'btn btn-large'  %>
  <%= link_to "<i class='icon-edit'></i> ".html_safe + t('.edit', :default => t("helpers.links.edit")),
              edit_discipline_class_path(@discipline_class), :class => 'btn btn-large' %>
  <%= link_to "<i class='icon-pencil'></i> ".html_safe + t('Aulas'),
			   discipline_class_class_records_path(@discipline_class), :class => 'btn btn-large' %>
  <%= link_to "<i class='icon-user'></i> ".html_safe + t('Docentes'),
			   discipline_class_class_teachings_path(@discipline_class), :class => 'btn btn-large' %>
  <%= link_to "<i class='icon-align-justify'></i> ".html_safe + t('Avaliações'),
			   discipline_class_discipline_class_exams_path(@discipline_class), :class => 'btn btn-large' %> 
  
  <%= link_to "<i class='icon-group'></i> ".html_safe + t('Enturmação'),
               discipline_class_registration_classes_path(@discipline_class), :class => 'btn btn-large' %> 


  <%= link_to "<i class='icon-trash'></i> ".html_safe + t('.destroy', :default => t("helpers.links.destroy")),
              discipline_class_path(@discipline_class),
              :method => 'delete',
              :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Deseja excluir?')),
              :class => 'btn btn-danger btn-large pull-right' %>
</div>
</div>